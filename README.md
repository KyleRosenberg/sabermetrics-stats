# MLB Stat Sandbox
MLB Stat Sandbox allows anyone to perform basic exploratory research into the world of sabermetrics. The site allows you to build a stat from the ground up using simple stats from the lahman database and view how your stat compares and correlates to team wins, and either FIP or wOBA. The front end takes advantage of the [Fomantic-UI](https://github.com/fomantic/Fomantic-UI) web framework so I don't have to deal with css and design.
  
## Stats
The lahman database provides a lot of data for a lot of stats for many different aspects of baseball. For now, only the pitching and batting dataframes are available due to their simplcity. The fielding datframe was another candidate, but since the differences between positions for how players should be performing are potentially significant, I left it out. I also added FIP to the default pitching dataframe, and wOBA to the default batting dataframe, since those are two commonly discussed stats for their respective aspect of the game.
  
## Usage
The left sidebar shows the available stat for the datframe chosen from the dropdown. The user can add a stat to their stat equation by clicking the green plus button, which will add an entry to the sidebar on the right along with updating the rendered equation in the center. The right sidebar displays the stats that are actively being used by the current equation, along with a constant that is added to the end. It also has numeric inputs for each stat that allow the user to change the coefficients and exponents for the associated stat. The red minus button intuitively allows the user to remove the stat from the current equation.
The Save Stat button will add the stat the user is currently building to the list of available stats on the right sidebar using the specified name and custom equation. Since the front end doesn't do any of the calculations, we have to save the actual equation to send to the server so that if the saved stat is used in another stat we can still calculate it. Custom stats also have an edit button that pulls up the saved data and allows the user to further modify it. Stats are only saved for the session and will not be saved if the user refreshes. The Visualize button is what sends the info to the server so that the user can see what their stat looks like. 

## Server
The server is written in python and uses Flask to handle the endpoints and HTTP requests. We're also using Pandas for dataframes, matplotlib for generating plots, scipy for linear regression, and most importantly pybaseball for the lahman database. The server specifically uses *pitching()*, *batting()*, and *teams()* data from the last 5 years. 
The first thing the server needs to do at the */visualize* endpoint, other than validating the inputs, is build the dataframe with the custom stats. The algorithm to do this is basically a cycle of two ideas. The first idea is that we should calculate the all stats from the equation that we can and put them in the dataframe. For example, the equation dictionary for FIP might have the key "HR1" with the value [13, 1]. Since the dataframe already has a column "HR", we can calculate "HR1" to be 13\*HR^1. The second idea is that if any of the stats in the equation were themselves custom stats, we need to calculate those before we can calculate the "main" stat. To do this, we look at the dictionary of custom stats, look at all the equations, and calculate any that we can (meaning we have all the parts of the equation calculated already). If after these two steps there are no more stats that need to be calculated for the final equation, we can calculate it and put it in the dataframe. If not we can just repeat the two steps until that condition is satisfied. 
The rest of the servers job is just making the plots. By default, the custom stat is plotted on a histogram alongside FIP and a normalized distribution of team wins. The same is also done with a scatter plot, where the custom stat is the feature predicting FIP and team wins. The scatter plot also contains the correlation coefficients, and best fit lines. Then, some code I found on stackoverflow is used to convert the plots into something that can be displayed in an HTML image tag.

## URL  
https://sabermetrics-stats.herokuapp.com
